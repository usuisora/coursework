{"version":3,"sources":["../../src/plugins/SubscriptionPlugin.js"],"names":["isValidSubscription","Subscription","Object","keys","getFields","length","e","SubscriptionPlugin","builder","hook","schema","build","newWithHooks","extend","graphql","GraphQLObjectType","inflection","name","builtin","description","__origin","isRootSubscription","subscription"],"mappings":";;;;;;;AAGA,SAASA,mBAAT,CAA6BC,YAA7B,EAA2C;AACzC,MAAI;AACF,QAAI,CAACA,YAAL,EAAmB;AACjB,aAAO,KAAP;AACD;AACD,QAAIC,OAAOC,IAAP,CAAYF,aAAaG,SAAb,EAAZ,EAAsCC,MAAtC,KAAiD,CAArD,EAAwD;AACtD,aAAO,KAAP;AACD;AACF,GAPD,CAOE,OAAOC,CAAP,EAAU;AACV,WAAO,KAAP;AACD;AACD,SAAO,IAAP;AACD;;kBAEe,eAAeC,kBAAf,CAAkCC,OAAlC,EAA2C;AACzDA,UAAQC,IAAR,CAAa,eAAb,EAA8B,CAACC,MAAD,EAAaC,KAAb,KAAuB;AACnD,UAAM;AACJC,kBADI;AAEJC,YAFI;AAGJC,eAAS,EAAEC,iBAAF,EAHL;AAIJC;AAJI,QAKFL,KALJ;AAMA,UAAMV,eAAeW,aACnBG,iBADmB,EAEnB;AACEE,YAAMD,WAAWE,OAAX,CAAmB,cAAnB,CADR;AAEEC,mBACE;AAHJ,KAFmB,EAOnB;AACEC,gBAAW,kDADb;AAEEC,0BAAoB;AAFtB,KAPmB,EAWnB,IAXmB,CAArB;AAaA,QAAIrB,oBAAoBC,YAApB,CAAJ,EAAuC;AACrC,aAAOY,OACLH,MADK,EAEL;AACEY,sBAAcrB;AADhB,OAFK,EAKL,oCALK,CAAP;AAOD,KARD,MAQO;AACL,aAAOS,MAAP;AACD;AACF,GA/BD;AAgCD,C","file":"SubscriptionPlugin.js","sourcesContent":["// @flow\nimport type { Plugin } from \"../SchemaBuilder\";\n\nfunction isValidSubscription(Subscription) {\n  try {\n    if (!Subscription) {\n      return false;\n    }\n    if (Object.keys(Subscription.getFields()).length === 0) {\n      return false;\n    }\n  } catch (e) {\n    return false;\n  }\n  return true;\n}\n\nexport default (async function SubscriptionPlugin(builder) {\n  builder.hook(\"GraphQLSchema\", (schema: {}, build) => {\n    const {\n      newWithHooks,\n      extend,\n      graphql: { GraphQLObjectType },\n      inflection,\n    } = build;\n    const Subscription = newWithHooks(\n      GraphQLObjectType,\n      {\n        name: inflection.builtin(\"Subscription\"),\n        description:\n          \"The root subscription type which contains root level fields which mutate data.\",\n      },\n      {\n        __origin: `graphile-build built-in (root subscription type)`,\n        isRootSubscription: true,\n      },\n      true\n    );\n    if (isValidSubscription(Subscription)) {\n      return extend(\n        schema,\n        {\n          subscription: Subscription,\n        },\n        \"Adding subscription type to schema\"\n      );\n    } else {\n      return schema;\n    }\n  });\n}: Plugin);\n"]}